{% extends "news/base.html" %}
{% load static %}

{% block content %}
<div class="container mx-auto px-2 py-6">
    <h2 class="text-2xl text-center font-bold mb-6">{{ category|title }}</h2>
  <div id="articles-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
    {% include "news/_article_cards.html" with page_obj=page_obj %}
  </div>
</div>
{% endblock %}

{% block loading_spinner %}
  <div id="loading" class="text-center my-4" style="display:none;">
    <img src="{% static 'loading.gif' %}" alt="Loading..." class="w-8 h-8 mx-auto">
  </div>
{% endblock %}

{% block extra_js %}
<script>
let page = 2, loading = false, hasNext = true;

window.addEventListener('scroll', () => {
  if (loading || !hasNext) return;
  if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 300) {
    loading = true;
    document.getElementById("loading").style.display = "block";

    const url = new URL(window.location.href);
    url.searchParams.set("page", page);

    fetch(url, {
      headers: { "X-Requested-With": "XMLHttpRequest" }
    })
    .then(response => response.json())
    .then(data => {
      if (data.html) {
        document.getElementById("articles-grid").insertAdjacentHTML("beforeend", data.html);
        hasNext = data.has_next;
        page++;
      }
    })
    .catch(console.error)
    .finally(() => {
      loading = false;
      document.getElementById("loading").style.display = "none";
    });
  }
});
</script>
{% endblock %}
